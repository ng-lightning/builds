// Check if given value is integer. Cast strings as potential integers as well.
// See: http://stackoverflow.com/questions/14636536/how-to-check-if-a-variable-is-an-integer-in-javascript
export function isInt(value) {
    if (isNaN(value)) {
        return false;
    }
    const x = parseFloat(value);
    // eslint-disable-next-line no-bitwise
    return (x | 0) === x;
}
// Similar to `lodash.isobject`
export function isObject(value) {
    const type = typeof value;
    return !!value && (type === 'object' || type === 'function');
}
// Generate a unique id (unique within the entire client session).
// Useful for temporary DOM ids.
let idCounter = 0;
export function uniqueId(prefix = 'uid') {
    return `ngl_${prefix}_${++idCounter}`;
}
export function replaceClass(instance, oldClass, newClass) {
    if (oldClass && oldClass !== newClass) {
        setClass(instance, oldClass, false);
    }
    if (newClass) {
        setClass(instance, newClass, true);
    }
}
function setClass(instance, klasses, isAdd) {
    if (klasses) {
        (Array.isArray(klasses) ? klasses : [klasses]).forEach(k => {
            instance.renderer[isAdd ? 'addClass' : 'removeClass'](instance.element.nativeElement, k);
        });
    }
}
function isString(value) {
    return typeof value === 'string';
}
function isSet(value) {
    return value instanceof Set;
}
function isArray(value) {
    return Array.isArray(value);
}
export function ngClassCombine(ngClasses, customClasses) {
    if (!ngClasses) {
        return customClasses;
    }
    let ngClassesObj = {};
    const classesReducer = (obj, klass) => {
        obj[klass] = true;
        return obj;
    };
    if (isString(ngClasses)) {
        ngClassesObj = ngClasses.split(/\s+/).reduce(classesReducer, {});
    }
    else if (isSet(ngClasses)) {
        ngClassesObj = Array.from(ngClasses).reduce(classesReducer, {});
    }
    else if (isArray(ngClasses)) {
        ngClassesObj = ngClasses.reduce(classesReducer, {});
    }
    else {
        ngClassesObj = ngClasses;
    }
    return { ...ngClassesObj, ...customClasses };
}
/**
   * Check whether value is currently selected.
   *
   * @param selection The value(s) currently selected
   * @param value The value in test, whether is (part of) selection or not
   * @param multiple Whether selections can be have multiple values
   */
export function isOptionSelected(value, selection, multiple) {
    // Multiple
    if (multiple) {
        if (!selection) {
            return false;
        }
        return Array.isArray(selection) ? selection.indexOf(value) > -1 : !!selection[value];
    }
    // Single
    return value === selection;
}
export function addOptionToSelection(value, selection, multiple, clearable = false) {
    let next;
    if (multiple) {
        if (!selection) {
            selection = [];
        }
        if (Array.isArray(selection)) {
            // Remove if already there or add to selection
            const index = selection.indexOf(value);
            next = index > -1
                ? [...selection.slice(0, index), ...selection.slice(index + 1)]
                : [...selection, value];
        }
        else {
            next = Object.assign({}, selection, { [value]: !selection[value] });
        }
    }
    else {
        next = selection === value && clearable ? null : value;
    }
    return next;
}
export function menuItemScroll(container, domItem, scrollPadding = 4) {
    if (domItem.offsetHeight - container.scrollTop + domItem.offsetTop >=
        container.offsetHeight) {
        container.scrollTop =
            domItem.offsetHeight +
                domItem.offsetTop -
                container.offsetHeight +
                scrollPadding;
    }
    else if (domItem.offsetTop <= container.scrollTop) {
        container.scrollTop = domItem.offsetTop - scrollPadding;
    }
}
export function trapEvent(event) {
    if (!event) {
        return;
    }
    event.preventDefault();
    event.stopPropagation();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWxpZ2h0bmluZy9zcmMvbGliL3V0aWwvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSwrRUFBK0U7QUFDL0UsMEdBQTBHO0FBQzFHLE1BQU0sVUFBVSxLQUFLLENBQUMsS0FBVTtJQUM5QixJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUNoQixPQUFPLEtBQUssQ0FBQztLQUNkO0lBQ0QsTUFBTSxDQUFDLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLHNDQUFzQztJQUN0QyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN2QixDQUFDO0FBRUQsK0JBQStCO0FBQy9CLE1BQU0sVUFBVSxRQUFRLENBQUMsS0FBVTtJQUNqQyxNQUFNLElBQUksR0FBRyxPQUFPLEtBQUssQ0FBQztJQUMxQixPQUFPLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLEtBQUssUUFBUSxJQUFJLElBQUksS0FBSyxVQUFVLENBQUMsQ0FBQztBQUMvRCxDQUFDO0FBRUQsa0VBQWtFO0FBQ2xFLGdDQUFnQztBQUNoQyxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7QUFDbEIsTUFBTSxVQUFVLFFBQVEsQ0FBQyxNQUFNLEdBQUcsS0FBSztJQUNyQyxPQUFPLE9BQU8sTUFBTSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUM7QUFDeEMsQ0FBQztBQU1ELE1BQU0sVUFBVSxZQUFZLENBQUMsUUFBdUIsRUFBRSxRQUEyQixFQUFFLFFBQTRCO0lBQzdHLElBQUksUUFBUSxJQUFJLFFBQVEsS0FBSyxRQUFRLEVBQUU7UUFDckMsUUFBUSxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDckM7SUFDRCxJQUFJLFFBQVEsRUFBRTtRQUNaLFFBQVEsQ0FBQyxRQUFRLEVBQUUs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QUFDO0tBQ2pCO1NBQU0sSUFBSSxPQUFPLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQyxTQUFTLEVBQUU7UUFDbkQsU0FBUyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUMsU0FBUyxHQUFHLGFBQWEsQ0FBQztLQUN6RDtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFDLEtBQVk7SUFDcEMsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUFFLE9BQU87S0FBRTtJQUN2QixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDdkIsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO0FBQzFCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmLCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuLy8gQ2hlY2sgaWYgZ2l2ZW4gdmFsdWUgaXMgaW50ZWdlci4gQ2FzdCBzdHJpbmdzIGFzIHBvdGVudGlhbCBpbnRlZ2VycyBhcyB3ZWxsLlxuLy8gU2VlOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE0NjM2NTM2L2hvdy10by1jaGVjay1pZi1hLXZhcmlhYmxlLWlzLWFuLWludGVnZXItaW4tamF2YXNjcmlwdFxuZXhwb3J0IGZ1bmN0aW9uIGlzSW50KHZhbHVlOiBhbnkpOiBib29sZWFuIHtcbiAgaWYgKGlzTmFOKHZhbHVlKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCB4ID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG4gIHJldHVybiAoeCB8IDApID09PSB4O1xufVxuXG4vLyBTaW1pbGFyIHRvIGBsb2Rhc2guaXNvYmplY3RgXG5leHBvcnQgZnVuY3Rpb24gaXNPYmplY3QodmFsdWU6IGFueSk6IGJvb2xlYW4ge1xuICBjb25zdCB0eXBlID0gdHlwZW9mIHZhbHVlO1xuICByZXR1cm4gISF2YWx1ZSAmJiAodHlwZSA9PT0gJ29iamVjdCcgfHwgdHlwZSA9PT0gJ2Z1bmN0aW9uJyk7XG59XG5cbi8vIEdlbmVyYXRlIGEgdW5pcXVlIGlkICh1bmlxdWUgd2l0aGluIHRoZSBlbnRpcmUgY2xpZW50IHNlc3Npb24pLlxuLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy5cbmxldCBpZENvdW50ZXIgPSAwO1xuZXhwb3J0IGZ1bmN0aW9uIHVuaXF1ZUlkKHByZWZpeCA9ICd1aWQnKTogc3RyaW5nIHtcbiAgcmV0dXJuIGBuZ2xfJHtwcmVmaXh9XyR7KytpZENvdW50ZXJ9YDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJUmVwbGFjZUNsYXNzIHtcbiAgcmVuZGVyZXI6IFJlbmRlcmVyMjtcbiAgZWxlbWVudDogRWxlbWVudFJlZjtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlQ2xhc3MoaW5zdGFuY2U6IElSZXBsYWNlQ2xhc3MsIG9sZENsYXNzOiBzdHJpbmcgfCBzdHJpbmdbXSwgbmV3Q2xhc3M/OiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuICBpZiAob2xkQ2xhc3MgJiYgb2xkQ2xhc3MgIT09IG5ld0NsYXNzKSB7XG4gICAgc2V0Q2xhc3MoaW5zdGFuY2UsIG9sZENsYXNzLCBmYWxzZSk7XG4gIH1cbiAgaWYgKG5ld0NsYXNzKSB7XG4gICAgc2V0Q2xhc3MoaW5zdGFuY2UsIG5ld0NsYXNzLCB0cnVlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRDbGFzcyhpbnN0YW5jZTogSVJlcGxhY2VDbGFzcywga2xhc3Nlczogc3RyaW5nIHwgc3RyaW5nW10sIGlzQWRkOiBib29sZWFuKSB7XG4gIGlmIChrbGFzc2VzKSB7XG4gICAgKEFycmF5LmlzQXJyYXkoa2xhc3NlcykgPyBrbGFzc2VzIDogW2tsYXNzZXNdKS5mb3JFYWNoKGsgPT4ge1xuICAgICAgaW5zdGFuY2UucmVuZGVyZXJbaXNBZGQgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oaW5zdGFuY2UuZWxlbWVudC5uYXRpdmVFbGVtZW50LCBrKTtcbiAgICB9KTtcbiAgfVxufVxuXG50eXBlIE5nQ2xhc3NUeXBlID0gc3RyaW5nIHwgc3RyaW5nW10gfCBTZXQ8c3RyaW5nPiB8IHsgW2tsYXNzOiBzdHJpbmddOiBhbnkgfTtcblxuZnVuY3Rpb24gaXNTdHJpbmcodmFsdWU6IE5nQ2xhc3NUeXBlKTogdmFsdWUgaXMgc3RyaW5nIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZyc7XG59XG5cbmZ1bmN0aW9uIGlzU2V0KHZhbHVlOiBOZ0NsYXNzVHlwZSk6IHZhbHVlIGlzIFNldDxzdHJpbmc+IHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgU2V0O1xufVxuXG5mdW5jdGlvbiBpc0FycmF5KHZhbHVlOiBOZ0NsYXNzVHlwZSk6IHZhbHVlIGlzIHN0cmluZ1tdIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbmdDbGFzc0NvbWJpbmUobmdDbGFzc2VzOiBOZ0NsYXNzVHlwZSwgY3VzdG9tQ2xhc3NlczogeyBba2xhc3M6IHN0cmluZ106IGFueSB9KSB7XG4gIGlmICghbmdDbGFzc2VzKSB7XG4gICAgcmV0dXJuIGN1c3RvbUNsYXNzZXM7XG4gIH1cblxuICBsZXQgbmdDbGFzc2VzT2JqOiB7IFtrbGFzczogc3RyaW5nXTogYW55IH0gPSB7fTtcblxuICBjb25zdCBjbGFzc2VzUmVkdWNlciA9IChvYmo6IHsgW2tsYXNzOiBzdHJpbmddOiBhbnkgfSwga2xhc3M6IHN0cmluZykgPT4ge1xuICAgIG9ialtrbGFzc10gPSB0cnVlO1xuICAgIHJldHVybiBvYmo7XG4gIH07XG5cbiAgaWYgKGlzU3RyaW5nKG5nQ2xhc3NlcykpIHtcbiAgICBuZ0NsYXNzZXNPYmogPSBuZ0NsYXNzZXMuc3BsaXQoL1xccysvKS5yZWR1Y2UoY2xhc3Nlc1JlZHVjZXIsIHt9KTtcbiAgfSBlbHNlIGlmIChpc1NldChuZ0NsYXNzZXMpKSB7XG4gICAgbmdDbGFzc2VzT2JqID0gQXJyYXkuZnJvbShuZ0NsYXNzZXMpLnJlZHVjZShjbGFzc2VzUmVkdWNlciwge30pO1xuICB9IGVsc2UgaWYgKGlzQXJyYXkobmdDbGFzc2VzKSkge1xuICAgIG5nQ2xhc3Nlc09iaiA9IG5nQ2xhc3Nlcy5yZWR1Y2UoY2xhc3Nlc1JlZHVjZXIsIHt9KTtcbiAgfSBlbHNlIHtcbiAgICBuZ0NsYXNzZXNPYmogPSBuZ0NsYXNzZXM7XG4gIH1cblxuICByZXR1cm4geyAuLi5uZ0NsYXNzZXNPYmosIC4uLmN1c3RvbUNsYXNzZXMgfTtcbn1cblxuXG4vKipcbiAgICogQ2hlY2sgd2hldGhlciB2YWx1ZSBpcyBjdXJyZW50bHkgc2VsZWN0ZWQuXG4gICAqXG4gICAqIEBwYXJhbSBzZWxlY3Rpb24gVGhlIHZhbHVlKHMpIGN1cnJlbnRseSBzZWxlY3RlZFxuICAgKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIGluIHRlc3QsIHdoZXRoZXIgaXMgKHBhcnQgb2YpIHNlbGVjdGlvbiBvciBub3RcbiAgICogQHBhcmFtIG11bHRpcGxlIFdoZXRoZXIgc2VsZWN0aW9ucyBjYW4gYmUgaGF2ZSBtdWx0aXBsZSB2YWx1ZXNcbiAgICovXG5leHBvcnQgZnVuY3Rpb24gaXNPcHRpb25TZWxlY3RlZCh2YWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgYW55LCBzZWxlY3Rpb246IGFueSB8IGFueVtdLCBtdWx0aXBsZTogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAvLyBNdWx0aXBsZVxuICBpZiAobXVsdGlwbGUpIHtcbiAgICBpZiAoIXNlbGVjdGlvbikgeyByZXR1cm4gZmFsc2U7IH1cbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShzZWxlY3Rpb24pID8gc2VsZWN0aW9uLmluZGV4T2YodmFsdWUpID4gLTEgOiAhIXNlbGVjdGlvblt2YWx1ZV07XG4gIH1cblxuICAvLyBTaW5nbGVcbiAgcmV0dXJuIHZhbHVlID09PSBzZWxlY3Rpb247XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRPcHRpb25Ub1NlbGVjdGlvbih2YWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgYW55LCBzZWxlY3Rpb246IGFueSB8IGFueVtdLCBtdWx0aXBsZTogYm9vbGVhbiwgY2xlYXJhYmxlID0gZmFsc2UpIHtcbiAgbGV0IG5leHQ6IGFueTtcbiAgaWYgKG11bHRpcGxlKSB7XG4gICAgaWYgKCFzZWxlY3Rpb24pIHtcbiAgICAgIHNlbGVjdGlvbiA9IFtdO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShzZWxlY3Rpb24pKSB7XG4gICAgICAvLyBSZW1vdmUgaWYgYWxyZWFkeSB0aGVyZSBvciBhZGQgdG8gc2VsZWN0aW9uXG4gICAgICBjb25zdCBpbmRleCA9IHNlbGVjdGlvbi5pbmRleE9mKHZhbHVlKTtcbiAgICAgIG5leHQgPSBpbmRleCA+IC0xXG4gICAgICAgID8gWy4uLnNlbGVjdGlvbi5zbGljZSgwLCBpbmRleCksIC4uLnNlbGVjdGlvbi5zbGljZShpbmRleCArIDEpXVxuICAgICAgICA6IFsuLi5zZWxlY3Rpb24sIHZhbHVlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV4dCA9IE9iamVjdC5hc3NpZ24oe30sIHNlbGVjdGlvbiwgeyBbdmFsdWVdOiAhc2VsZWN0aW9uW3ZhbHVlXSB9KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbmV4dCA9IHNlbGVjdGlvbiA9PT0gdmFsdWUgJiYgY2xlYXJhYmxlID8gbnVsbCA6IHZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIG5leHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZW51SXRlbVNjcm9sbCAoY29udGFpbmVyLCBkb21JdGVtLCBzY3JvbGxQYWRkaW5nID0gNCkge1xuICBpZiAoXG4gICAgZG9tSXRlbS5vZmZzZXRIZWlnaHQgLSBjb250YWluZXIuc2Nyb2xsVG9wICsgZG9tSXRlbS5vZmZzZXRUb3AgPj1cbiAgICBjb250YWluZXIub2Zmc2V0SGVpZ2h0XG4gICkge1xuICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPVxuICAgICAgZG9tSXRlbS5vZmZzZXRIZWlnaHQgK1xuICAgICAgZG9tSXRlbS5vZmZzZXRUb3AgLVxuICAgICAgY29udGFpbmVyLm9mZnNldEhlaWdodCArXG4gICAgICBzY3JvbGxQYWRkaW5nO1xuICB9IGVsc2UgaWYgKGRvbUl0ZW0ub2Zmc2V0VG9wIDw9IGNvbnRhaW5lci5zY3JvbGxUb3ApIHtcbiAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gZG9tSXRlbS5vZmZzZXRUb3AgLSBzY3JvbGxQYWRkaW5nO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0cmFwRXZlbnQoZXZlbnQ6IEV2ZW50KSB7XG4gIGlmICghZXZlbnQpIHsgcmV0dXJuOyB9XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xufVxuIl19